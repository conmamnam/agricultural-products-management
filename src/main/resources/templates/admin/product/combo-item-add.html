<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head th:replace="~{admin/layout :: common-styles}">
    <meta charset="UTF-8">
    <title>Thêm sản phẩm vào combo</title>
    <link rel="icon" type="image/png" href="/image/logo-web.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body { background: #f8f9fa; }
        .card { border-radius: 10px; }
        .table td, .table th { vertical-align: middle; }
        .table img { border-radius: 6px; }
        .btn-success { background-color: #198754; border: none; }
        .btn-success:hover { background-color: #157347; }
        .input-quantity { width: 80px; text-align: center; }
        .table-hover tbody tr:hover { background-color: #f1f5ff; }
    </style>
</head>

<body>
<header th:replace="~{admin/layout :: admin-header(user=${adminInfo})}"></header>

<div class="container-wrapper">
    <nav th:replace="~{admin/layout :: sidebar(currentPage='products')}"></nav>

    <main class="p-4">

        <!-- Thông tin combo -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fa fa-boxes me-2"></i>
                    Combo: <span th:text="${productParent.productName}"></span> |
                    Giá: <span th:text="${#numbers.formatDecimal(productParent.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
                </h4>
            </div>
        </div>

        <!-- Danh sách sản phẩm đã thêm vào combo -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fa fa-list me-2"></i>Sản phẩm trong combo</h5>
            </div>
            <div class="card-body">
                <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

                <table class="table table-bordered table-sm align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Tên sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item, iter : ${comboItems}">
                        <td th:text="${iter.index + 1}"></td>
                        <td th:text="${item.product.productName}"></td>
                        <td th:text="${item.quantity}"></td>
                        <td>
                            <a th:href="@{'/admin/products/combo/remove-item/' + ${item.id}}"
                               class="btn btn-sm btn-danger">
                                <i class="fa fa-trash"></i> Xóa
                            </a>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(comboItems)}">
                        <td colspan="4" class="text-center text-muted">Chưa có sản phẩm nào.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Danh sách sản phẩm để thêm vào combo -->
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fa fa-plus-circle me-2"></i>Thêm sản phẩm vào combo</h5>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-striped table-hover align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Tên sản phẩm</th>
                        <th>Giá</th>
                        <th>Tồn kho</th>
                        <th>Mô tả</th>
                        <th>Ảnh</th>
                        <th style="width: 100px;">Số lượng</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="p, iter : ${productList}">
                        <td th:text="${iter.index + 1}"></td>
                        <td th:text="${p.productName}"></td>
                        <td th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></td>
                        <td th:text="${p.stock}"></td>
                        <td th:text="${p.description}"></td>
                        <td>
                            <img th:src="${p.imageUrl}" alt="Ảnh" style="width:60px;height:60px;object-fit:cover;">
                        </td>
                        <td>
                            <input type="number" name="quantity"
                                   th:attr="form='form__' + ${p.productId}"
                                   value="1" min="1" max="999"
                                   class="form-control form-control-sm input-quantity">
                        </td>
                        <td>
                            <form th:id="'form__' + ${p.productId}" th:action="@{/admin/products/combo/add-item}" method="post">
                                <input type="hidden" name="comboId" th:value="${productParent.productId}" />
                                <input type="hidden" name="productId" th:value="${p.productId}" />
                                <button type="submit" class="btn btn-sm btn-success">
                                    <i class="fa fa-plus"></i> Thêm
                                </button>
                            </form>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(productList)}">
                        <td colspan="8" class="text-center text-muted">Không có sản phẩm nào để thêm.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>
</div>
</body>
</html>
